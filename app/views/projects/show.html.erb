<% provide(:title, "#{@project.name}'s Time Spents") %>

<div class="container">
  <div class="row">
    <div class="col-sm-10 col-md-10">
      <h2>
        <%= @project.name %>
        <% if @project.billable %>
          <span class="glyphicon glyphicon-usd"></span>
        <% end %>
      </h2>
    </div>
    <% if current_user == @project.creator %>
      <div class="col-sm-2 col-md-2">
        <%= link_to 'Edit', edit_project_path(@project), class: 'btn btn-primary col-sm-5 push-top' %>

        <% if @project.time_spents.empty? %>
          <%= link_to 'Delete', project_path(@project), data: { confirm: 'Are you sure?' }, method: :delete, class: 'btn btn-danger col-sm-offset-1 col-sm-5 push-top' %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @project.billable %>
    <div class="row">
      <div class="col-sm-10 col-md-10">
        <h3>Current Bill Rate: <%= humanized_money_with_symbol @project.hourly_rate %></h3>
      </div>
    </div>
  <% end %>

  <div class="row">
    <div class="col-sm-10 col-md-10">
      <h3>Description: <%= @project.description %></h3>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-10 col-md-10">
      <% if @project.public? %>
        <h3>Public project</h3>
      <% else %>
        <h3>Private project</h3>
      <% end %>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12 col-md-12">
      <ul class="nav nav-tabs" id="myTab" data-tabs="tabs">
        <li class="active">
          <a href="#time_spents" data-toggle="tab">Time Spents</a>
        </li>

        <li>
          <a href="#users" data-toggle="tab">User Distribution</a>
        </li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="time_spents">
          <table class="table table-bordered table-striped push-top">
            <tbody>
              <tr>
                <th>User</th>
                <th>Description</th>
                <th>Ended</th>
                <th>Hours Worked</th>
                <th>Paid for?</th>
                <th>Actions</th>
              </tr>
              <% if @time_spents.any? %>
                <%= render @time_spents %>
              <% else %>
                <tr>
                  <td colspan="6">No one has worked on <%= @project.name %> yet.</td>
                </tr>
              <% end %>
            </tbody>
          </table>

          <%= will_paginate(@time_spents) %>
        </div>

        <div class="tab-pane" id="users">
          <table class="table table-bordered table-striped push-top">
            <tbody>
              <tr>
                <th>User</th>
                <th>Total Time</th>
                <th>Percentage of Total Work</th>
              </tr>
              <% if @users.any? %>
                <%= render partial: 'users/user_distribution', collection: @users, as: :user %>
              <% else %>
                <tr>
                  <td colspan="5">No users have worked on <%= @project.name %> yet.</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>